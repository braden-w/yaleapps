---
import { db } from '@repo/db/courses';
import Layout from '../layouts/Layout.astro';
import { getCoursesBySeason, seasonCodeSchema } from './_[seasonCode]';
import { CoursesDataTable } from './_courses/CoursesDataTable';

export async function getStaticPaths() {
	const allSeasons = await db.query.seasons.findMany();
	return Promise.all(
		allSeasons.map(async ({ season_code, term, year }) => {
			const seasonCode = seasonCodeSchema.parse(season_code);
			const allCourses = await getCoursesBySeason(seasonCode);
			return {
				params: { seasonCode },
				props: { allCourses, year, term },
			};
		}),
	);
}

// const { seasonCode, year, term } = Astro.params;
const { allCourses } = Astro.props;
---

<Layout>
	<CoursesDataTable courses={allCourses} client:load />
</Layout>
